<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¸ƒå¤• Â· çµ¦å°é‡‘é³³çš„ä¸€å°æƒ…æ›¸</title>
  <meta name="description" content="åƒå½°å¯«çµ¦å°é‡‘é³³çš„ä¸ƒå¤•æƒ…æ›¸â€”â€”ä¸€é æº«æŸ”ã€å¯äº’å‹•ã€å¯ä¿å­˜ã€‚"/>
  <style>
    :root{
      --bg: #fffaf7;
      --card: #ffffff;
      --ink: #2b2b2b;
      --rose: #ff7a8a;
      --rose-deep:#ff4d68;
      --soft:#f9e5ea;
      --accent:#f7b7c3;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    [data-theme="night"]{
      --bg: #0d0b10;
      --card:#14121a;
      --ink:#f2eef6;
      --rose:#ff8896;
      --rose-deep:#ff657b;
      --soft:#201924;
      --accent:#2b2230;
      --shadow: 0 12px 34px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", Arial;
      background: radial-gradient(1200px 700px at 10% -10%, var(--soft), transparent),
                  radial-gradient(900px 500px at 110% 10%, var(--accent), transparent),
                  var(--bg);
      color:var(--ink);
      transition: background .6s ease, color .6s ease;
    }
    .wrap{max-width: 960px; margin: 4rem auto; padding: 0 1rem;}
    .hero{
      display:flex; flex-direction:column; align-items:center; gap:.6rem; text-align:center;
    }
    .title{font-weight:800; letter-spacing:.06em; font-size: clamp(28px, 6vw, 56px);}
    .subtitle{opacity:.8; font-size: clamp(14px, 2.4vw, 18px)}
    .heart-btn{
      margin-top: 1rem;
      display:inline-grid; place-items:center; width:120px; aspect-ratio:1; border-radius: 26px;
      background: linear-gradient(180deg, var(--rose), var(--rose-deep));
      color:#fff; font-weight:700; border:none; box-shadow: var(--shadow); cursor:pointer;
      transition: transform .15s ease;
    }
    .heart-btn:hover{ transform: translateY(-2px) scale(1.02); }
    .heart{ font-size: 34px; animation: beat 1.2s ease-in-out infinite; }
    @keyframes beat{ 0%,100%{ transform: scale(1)} 30%{ transform: scale(1.12)} 60%{ transform: scale(.96)} }

    .card{
      margin: 2rem auto 1rem;
      background: var(--card);
      border-radius: 22px; box-shadow: var(--shadow);
      overflow:hidden; position: relative;
    }
    .ribbon{
      position:absolute; inset:0; pointer-events:none; opacity:.08;
      background: repeating-linear-gradient( 45deg, transparent 0 16px, var(--rose) 16px 18px, transparent 18px 34px);
      filter: blur(.7px);
    }
    .letter{
      padding: clamp(20px, 4vw, 44px);
      line-height: 1.9; font-size: clamp(15px, 2.6vw, 18px);
    }
    .seal{ 
      position:absolute; inset:0; display:grid; place-items:center; background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.8));
      backdrop-filter: blur(2px); transition: opacity .7s ease;
    }
    .seal.hidden{ opacity:0; pointer-events:none}
    .seal .wax{
      display:grid; place-items:center; width: 120px; aspect-ratio:1; border-radius: 50%;
      background: radial-gradient(circle at 35% 30%, #ffd3db, var(--rose)); color:#fff; box-shadow: var(--shadow);
      font-weight:800; letter-spacing:.08em;
    }
    .meta{ display:flex; align-items:center; gap: .8rem; justify-content:space-between; padding: 1rem 1.2rem; opacity:.85; border-top: 1px dashed rgba(0,0,0,.08)}
    .pill{ padding:.35rem .8rem; border-radius: 100px; background: var(--soft); font-size: 12px }

    .controls{
      display:flex; flex-wrap:wrap; gap:.6rem; justify-content:center; margin: 1rem auto 2rem;
    }
    .btn{ border:1px solid transparent; background: var(--card); box-shadow: var(--shadow); color: var(--ink);
      padding:.6rem .9rem; border-radius:12px; cursor:pointer; transition:.2s; font-weight:600; }
    .btn:hover{ transform: translateY(-1px)}

    /* é¡˜æœ›ä¾¿åˆ©è²¼ */
    .wishbox{ display:flex; gap:.5rem; justify-content:center; flex-wrap:wrap; }
    .wishbox input{ 
      min-width: 260px; max-width: calc(100% - 100px); flex: 1 1 260px; 
      padding:.65rem .8rem; border-radius:12px; border: 1px solid rgba(0,0,0,.08); background: var(--card); color: var(--ink);
      box-shadow: var(--shadow);
    }
    .notes{ position: relative; min-height: 120px; margin: 1.2rem 0 0; }
    .note{ position:absolute; padding: .8rem .9rem; width: 180px; min-height: 80px; background: #fff9c4; color:#333;
      box-shadow: 0 8px 18px rgba(0,0,0,.12); border-radius: 10px; transform: rotate(var(--r, -2deg));
    }

    /* å°è´è¶ */
    .butterfly{ position: fixed; left:-40px; bottom: 12px; font-size: 22px; opacity:.9; filter: saturate(1.1)}
    .butterfly span{ display:inline-block; animation: fly 12s linear infinite; }
    @keyframes fly{
      0%{ transform: translateX(0) translateY(0) rotate(0deg)}
      20%{ transform: translateX(25vw) translateY(-6vh) rotate(12deg)}
      40%{ transform: translateX(50vw) translateY(-1vh) rotate(-8deg)}
      60%{ transform: translateX(70vw) translateY(-10vh) rotate(6deg)}
      80%{ transform: translateX(90vw) translateY(-3vh) rotate(-4deg)}
      100%{ transform: translateX(110vw) translateY(-14vh) rotate(0deg)}
    }

    /* æ„›å¿ƒå°é›¨ */
    .confetti{position: fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti i{ position:absolute; font-size: 18px; animation: rise 2.4s linear forwards; opacity:.9 }
    @keyframes rise{ from{ transform: translateY(20vh) scale(.8)} to{ transform: translateY(-110vh) scale(1.1); opacity:0 } }

    footer{ text-align:center; opacity:.7; padding: 1.2rem 0 2.4rem; font-size: 13px }
    a.link{ color: var(--rose-deep); text-decoration: none; font-weight:700 }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero" aria-label="hero">
      <div class="title">ä¸ƒå¤• Â· ä¸€å°åªå¯«çµ¦å¦³çš„æƒ…æ›¸</div>
      <div class="subtitle">æ”¶ä»¶äººï¼š<strong>å°é‡‘é³³</strong>ã€€|ã€€å¯„ä»¶äººï¼š<strong>åƒå½°</strong></div>
      <button class="heart-btn" id="openBtn" aria-label="æ‰“é–‹æƒ…æ›¸">
        <div class="heart">â¤</div>
        <small style="margin-top:6px;opacity:.9">æ‰“é–‹</small>
      </button>
    </header>

    <main class="card" aria-label="letter-card">
      <div class="ribbon" aria-hidden="true"></div>
      <section class="letter" id="letter">
        <article id="content" aria-live="polite"></article>
        <div class="meta">
          <div class="pill" id="now">â€”</div>
          <div class="pill">é¡˜å¦³è‡ªåœ¨ Â· æº«æŸ” Â· è¢«çæƒœ</div>
        </div>
      </section>
      <div class="seal" id="seal" aria-label="å°è Ÿ">
        <div class="wax">çµ¦å°é‡‘é³³</div>
      </div>
    </main>

    <section class="controls" aria-label="controls">
      <button class="btn" id="theme">åˆ‡æ›æ—¥/å¤œ</button>
      <button class="btn" id="print">åˆ—å°/å­˜æˆPDF</button>
      <button class="btn" id="replay">é‡çœ‹æ‰“å­—å‹•ç•«</button>
    </section>

    <section aria-label="é¡˜æœ›ä¾¿åˆ©è²¼" class="wishbox">
      <input id="wishInput" placeholder="å¯«ä¸‹ä¸€å¥æ­¤åˆ»çš„å¿ƒé¡˜â€¦ï¼ˆåƒ…å­˜æ–¼æœ¬æ©Ÿï¼‰" maxlength="80" />
      <button class="btn" id="addWish">åŠ å…¥é¡˜æœ›</button>
    </section>
    <div class="notes" id="notes"></div>

    <footer>
      <div>é€™é é¢åªå±¬æ–¼æˆ‘å€‘ã€‚å¦³å¯ä»¥ç›´æ¥å­˜æˆ <em>.html</em> ç•™åœ¨æ¡Œé¢ï¼›æœ‰å¤©æƒ³æˆ‘ï¼Œå°±æ‰“é–‹å®ƒã€‚ã€€â€” åƒå½°</div>
    </footer>
  </div>

  <div class="butterfly" aria-hidden="true"><span>ğŸ¦‹</span></div>
  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <script>
    const el = {
      open: document.getElementById('openBtn'),
      seal: document.getElementById('seal'),
      content: document.getElementById('content'),
      now: document.getElementById('now'),
      theme: document.getElementById('theme'),
      print: document.getElementById('print'),
      replay: document.getElementById('replay'),
      wishInput: document.getElementById('wishInput'),
      addWish: document.getElementById('addWish'),
      notes: document.getElementById('notes'),
      confetti: document.getElementById('confetti')
    };

    // ä¸ƒå¤•æƒ…æ›¸ï¼ˆæº«æŸ” Â· ç°¡æ½” Â· å°å¦³èªªï¼‰
    const letter = `è¦ªæ„›çš„å°é‡‘é³³ï¼š\n\n
ä»Šæ™šä¸ä¸€å®šçœ‹å¾—è¦‹éŠ€æ²³ï¼Œä½†æˆ‘æŠŠæ©‹æ­åœ¨æˆ‘å€‘ä¹‹é–“ã€‚\n
æˆ‘å–œæ­¡å¦³æ¸…æ™¨å››é»çš„é¢¨ï¼Œå–œæ­¡åŒ—å±±é‡Œçš„è…³æ­¥è²ï¼Œå–œæ­¡å¦³æŠŠä¸€å¤©å¯«é€²æ—¥èªŒæ™‚çš„å°ˆæ³¨ã€‚\n
å¦³èªªã€Œè‡ªç”±çš„äººç”Ÿã€è¦æœ‰äº”ç¨®è‡ªç”±ï¼Œæˆ‘æƒ³å†å¤šåŠ ä¸€ç¨®â€”â€”å’Œå¦³åœ¨ä¸€èµ·æ™‚ï¼Œå¿ƒçš„è‡ªç”±ã€‚\n
æˆ‘æœƒè¨˜å¾—ï¼šæ…¢ä¸€é»ã€è¼•ä¸€é»ã€ç©©ä¸€é»ï¼›ç”¨ä¸å¼µæšçš„æ–¹å¼ï¼ŒæŠŠæº«æŸ”æ”¾é€²å¦³çš„æ—¥å¸¸ã€‚\n
ç•¶ä¸–ç•Œå¤ªåµï¼Œæˆ‘å°±åšå¦³å£è¢‹è£¡çš„éœè¬ï¼›ç•¶å¤œè‰²å¾ˆæ·±ï¼Œæˆ‘å°±åšå¦³çª—é‚Šçš„å¾®å…‰ã€‚\n
å¦³å€¼å¾—è¢«å¥½å¥½å°å¾…ï¼Œä¹Ÿå€¼å¾—è¢«é•·é•·ä¹…ä¹…åœ°æ“æŠ±ã€‚\n
ä¸ƒå¤•å¿«æ¨‚ã€‚\n
åƒå½°ã€€æ–¼æ­¤åˆ»`;

    function typeText(text, el, speed=22){
      el.innerHTML = '';
      let i = 0;
      return new Promise(resolve=>{
        const timer = setInterval(()=>{
          el.textContent += text[i++];
          if(i >= text.length){ clearInterval(timer); resolve(); }
        }, speed);
      })
    }

    function nowStr(){
      const d = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      return `ä»Šå¤© Â· ${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function heartConfetti(count=38){
      const w = window.innerWidth, h = window.innerHeight;
      for(let i=0;i<count;i++){
        const e = document.createElement('i');
        e.textContent = Math.random()>.5 ? 'â¤' : 'ğŸ’—';
        e.style.left = (Math.random()*w) + 'px';
        e.style.top = (h + Math.random()*80) + 'px';
        e.style.transform = `translateY(0) scale(${.8 + Math.random()*.6})`;
        e.style.animationDelay = (Math.random()*0.8)+'s';
        el.confetti.appendChild(e);
        setTimeout(()=> e.remove(), 3000);
      }
    }

    function setTime(){ el.now.textContent = nowStr(); }

    // é¡˜æœ›ä¾¿åˆ©è²¼ï¼ˆæœ¬æ©Ÿï¼‰
    const KEY='qixi_wishes_v1';
    function loadNotes(){
      const list = JSON.parse(localStorage.getItem(KEY)||'[]');
      el.notes.innerHTML='';
      const colors = ['#fff9c4','#ffd8e1','#e1f5fe','#e8f5e9'];
      list.forEach((t,idx)=>{
        const n = document.createElement('div');
        n.className='note';
        n.style.setProperty('--r', `${(Math.random()*6-3).toFixed(2)}deg`);
        n.style.background = colors[idx%colors.length];
        // éš¨æ©Ÿä½ç½®ä½†ä¸æº¢å‡º
        const x = Math.random()*(el.notes.clientWidth-200);
        const y = Math.random()*(el.notes.clientHeight-100);
        n.style.left = Math.max(6,x)+'px';
        n.style.top = Math.max(6,y)+'px';
        n.textContent = t;
        el.notes.appendChild(n);
      })
    }

    function addNote(){
      const v = el.wishInput.value.trim();
      if(!v) return;
      const list = JSON.parse(localStorage.getItem(KEY)||'[]');
      list.push(v);
      localStorage.setItem(KEY, JSON.stringify(list.slice(-24))); // æœ€å¤šä¿ç•™ 24 å‰‡
      el.wishInput.value='';
      loadNotes();
      heartConfetti(16);
    }

    // äº‹ä»¶
    el.open.addEventListener('click', async ()=>{
      el.seal.classList.add('hidden');
      setTime();
      heartConfetti();
      await typeText(letter, el.content);
    });

    el.replay.addEventListener('click', async()=>{
      await typeText(letter, el.content);
      heartConfetti(18);
    })

    el.theme.addEventListener('click', ()=>{
      const night = document.documentElement.getAttribute('data-theme')==='night';
      document.documentElement.setAttribute('data-theme', night? 'day':'night');
      localStorage.setItem('qixi_theme', night? 'day':'night');
    })

    el.print.addEventListener('click', ()=> window.print());
    el.addWish.addEventListener('click', addNote);
    el.wishInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') addNote(); })

    // åˆå§‹åŒ–
    (function init(){
      // ä¸»é¡Œ
      const saved = localStorage.getItem('qixi_theme');
      if(saved){ document.documentElement.setAttribute('data-theme', saved); }
      // åˆå§‹é¡¯ç¤ºæ™‚é–“
      setTime();
      // è´è¶éš¨æ©Ÿå»¶é²
      document.querySelector('.butterfly span').style.animationDelay = (Math.random()*3)+'s';
      // é¡˜æœ›
      loadNotes();
    })();
  </script>
</body>
</html>
