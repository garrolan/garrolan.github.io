<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ°å¾Œå°ç£ç¶“æ¿Ÿç™¼å±•ï¼šäººç”Ÿé¸æ“‡å¤§å†’éšªï¼ˆå…­é—œå¡ï¼‰</title>
  <style>
    :root{
      --bg1:#070014;
      --bg2:#12002a;
      --card:#120822cc;
      --stroke:#ffffff2a;
      --txt:#f7f3ff;
      --muted:#cbbcff;
      --good:#35ff8a;
      --mid:#ffd34e;
      --bad:#ff4e88;
      --accent:#7c4dff;
      --accent2:#00e5ff;
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --shake: 1;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC", "Microsoft JhengHei", "Noto Sans TC", sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, #2a0a66 0%, transparent 60%),
        radial-gradient(900px 600px at 85% 20%, #003b7a 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 95%, #3b0047 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* èƒŒæ™¯æ¼«ç•«çˆ†ç‚¸é»é» */
    .dots{
      position:fixed; inset:0;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.10) 0 2px, transparent 2.2px),
        radial-gradient(circle at 30% 60%, rgba(255,255,255,.09) 0 2px, transparent 2.2px),
        radial-gradient(circle at 70% 30%, rgba(255,255,255,.08) 0 2px, transparent 2.2px),
        radial-gradient(circle at 85% 70%, rgba(255,255,255,.07) 0 2px, transparent 2.2px);
      background-size: 140px 140px;
      mix-blend-mode: screen;
      opacity:.55;
      pointer-events:none;
      filter: blur(.2px);
      animation: drift 14s linear infinite;
    }
    @keyframes drift{ to{ transform: translate3d(-40px, 20px, 0); } }

    /* ä¸Šæ–¹éœ“è™¹æ¨™é¡Œæ¢ */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(90deg, rgba(124,77,255,.35), rgba(0,229,255,.20));
      border-bottom:1px solid rgba(255,255,255,.16);
    }
    .topbar-inner{
      max-width:1100px; margin:0 auto;
      padding:12px 16px;
      display:flex; align-items:center; gap:12px; justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      user-select:none;
    }
    .logo{
      width:40px; height:40px; border-radius:14px;
      background: conic-gradient(from 120deg, var(--accent), var(--accent2), #ff4edb, var(--accent));
      box-shadow: 0 0 0 2px rgba(255,255,255,.18), 0 10px 30px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40%;
      background: linear-gradient(120deg, rgba(255,255,255,.0), rgba(255,255,255,.35), rgba(255,255,255,.0));
      transform: rotate(20deg);
      animation: shine 2.8s ease-in-out infinite;
    }
    @keyframes shine{
      0%{ transform: translateX(-60%) rotate(20deg); opacity:.0; }
      35%{ opacity:.6; }
      70%{ opacity:.0; }
      100%{ transform: translateX(80%) rotate(20deg); opacity:0; }
    }
    .brand h1{
      margin:0;
      font-size:16px;
      letter-spacing:.5px;
      text-shadow: 0 0 10px rgba(0,229,255,.25);
      line-height:1.1;
    }
    .brand small{
      display:block;
      color: rgba(255,255,255,.85);
      opacity:.85;
      font-size:12px;
      letter-spacing:.2px;
    }

    .pill{
      display:flex; gap:10px; align-items:center;
      font-size:12px;
      color: rgba(255,255,255,.92);
    }
    .pill .tag{
      padding:6px 10px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.20);
      border-radius:999px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.20);
      user-select:none;
      white-space:nowrap;
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 70px;
      display:grid;
      grid-template-columns: 1.4fr .9fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      .side{ order:2; }
    }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(800px 300px at 20% 0%, rgba(124,77,255,.18), transparent 60%),
        radial-gradient(800px 300px at 80% 0%, rgba(0,229,255,.14), transparent 60%);
      pointer-events:none;
    }

    .hero{
      padding:18px 18px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      border-bottom:1px dashed rgba(255,255,255,.16);
      position:relative;
    }
    .hero .title{
      display:flex; flex-direction:column; gap:6px;
      position:relative;
      z-index:1;
    }
    .hero .title h2{
      margin:0;
      font-size:20px;
      letter-spacing:.6px;
    }
    .hero .title p{
      margin:0;
      color: rgba(255,255,255,.85);
      font-size:13px;
      line-height:1.35;
    }

    .meter{
      display:flex; flex-direction:column; align-items:flex-end; gap:8px;
      min-width:220px;
      position:relative; z-index:1;
    }
    .bar{
      width:100%;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.12);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.16);
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent), #ff4edb);
      border-radius:999px;
      transition: width .45s ease;
      box-shadow: 0 0 14px rgba(0,229,255,.25);
    }
    .meter .nums{
      font-size:12px;
      color: rgba(255,255,255,.90);
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      user-select:none;
    }
    .nums span{
      padding:4px 8px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.14);
    }

    .stage{
      padding:18px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      position:relative;
      z-index:1;
    }

    .scene{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 520px){
      .scene{ grid-template-columns: 1fr; }
    }

    .avatar{
      width:140px;
      height:140px;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.24), transparent 55%),
        conic-gradient(from 90deg, rgba(0,229,255,.35), rgba(124,77,255,.35), rgba(255,78,136,.30), rgba(0,229,255,.35));
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
      transform: rotate(-1deg);
    }
    .avatar .emoji{
      font-size:54px;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.35));
    }
    .avatar .stamp{
      position:absolute;
      bottom:10px; right:10px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.18);
      font-size:12px;
      color: rgba(255,255,255,.92);
      transform: rotate(8deg);
      text-shadow: 0 0 10px rgba(0,229,255,.25);
      user-select:none;
    }

    .dialog{
      padding:14px 14px;
      border-radius:18px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.20);
    }
    .dialog h3{
      margin:0 0 8px;
      font-size:18px;
      letter-spacing:.5px;
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .badge{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(124,77,255,.18);
      color: rgba(255,255,255,.95);
      user-select:none;
    }
    .dialog p{
      margin:0;
      color: rgba(255,255,255,.88);
      font-size:14px;
      line-height:1.55;
    }

    .choices{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width: 680px){
      .choices{ grid-template-columns: 1fr; }
    }

    .btn{
      appearance:none;
      border:none;
      padding:12px 12px;
      border-radius:18px;
      cursor:pointer;
      color:var(--txt);
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      text-align:left;
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      min-height:86px;
    }
    .btn::before{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 60%);
      transform: rotate(12deg);
      opacity:.0;
      transition: opacity .18s ease;
    }
    .btn:hover{ transform: translateY(-2px) scale(1.01); filter: brightness(1.08); }
    .btn:hover::before{ opacity:.25; }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn .k{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .btn .k strong{
      font-size:14px;
      letter-spacing:.3px;
    }
    .btn .k .chip{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.28);
      user-select:none;
      white-space:nowrap;
    }
    .btn .t{
      font-size:13px;
      line-height:1.35;
      color: rgba(255,255,255,.9);
    }

    /* ä¸‰ç¨®é¸æ“‡çš„æˆ²åŠ‡è‰² */
    .btn.good{ background: linear-gradient(180deg, rgba(53,255,138,.22), rgba(0,0,0,.18)); }
    .btn.mid { background: linear-gradient(180deg, rgba(255,211,78,.20), rgba(0,0,0,.18)); }
    .btn.bad { background: linear-gradient(180deg, rgba(255,78,136,.20), rgba(0,0,0,.18)); }

    /* çµæœå€ */
    .result{
      display:none;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.24);
      position:relative;
      overflow:hidden;
    }
    .result.show{ display:block; animation: pop .35s ease; }
    @keyframes pop{
      0%{ transform: scale(.96); opacity:0; }
      100%{ transform: scale(1); opacity:1; }
    }
    .result .headline{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:8px;
    }
    .result .headline h4{
      margin:0;
      font-size:16px;
      letter-spacing:.5px;
      text-shadow: 0 0 16px rgba(0,229,255,.20);
    }
    .tone{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(124,77,255,.18);
      font-size:12px;
      user-select:none;
    }
    .tone.good{ background: rgba(53,255,138,.16); }
    .tone.mid{ background: rgba(255,211,78,.14); }
    .tone.bad{ background: rgba(255,78,136,.14); }

    .result p{ margin:0; color: rgba(255,255,255,.9); line-height:1.55; font-size:14px; }
    .hint{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.9);
      font-size:13px;
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .mini{
      cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.92);
      font-size:13px;
      box-shadow: 0 14px 35px rgba(0,0,0,.28);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    .mini:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .mini:active{ transform: translateY(1px); }
    .mini.primary{
      background: linear-gradient(90deg, rgba(0,229,255,.22), rgba(124,77,255,.25));
    }
    .mini.danger{
      background: linear-gradient(90deg, rgba(255,78,136,.18), rgba(0,0,0,.20));
    }

    /* å³å´ï¼šäººç”Ÿå±¥æ­· */
    .side .panel{
      padding:16px;
    }
    .panel h3{
      margin:0 0 10px;
      font-size:16px;
      letter-spacing:.4px;
    }
    .timeline{
      display:grid;
      gap:10px;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
    }
    .dot{
      width:34px; height:34px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      display:grid; place-items:center;
      background: rgba(255,255,255,.08);
      flex:0 0 auto;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
    }
    .row .meta{
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .row .meta .k{
      font-size:13px;
      color: rgba(255,255,255,.92);
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .row .meta .k span{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(124,77,255,.14);
      color: rgba(255,255,255,.9);
    }
    .row .meta .v{
      font-size:12px;
      color: rgba(255,255,255,.85);
      line-height:1.35;
      overflow:hidden;
      text-overflow:ellipsis;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient: vertical;
    }
    .row.locked{ opacity:.55; filter: grayscale(.25); }
    .row.done{ opacity:1; filter:none; border-color: rgba(0,229,255,.25); }

    .final{
      display:none;
      margin-top:10px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.24);
      overflow:hidden;
      position:relative;
    }
    .final.show{ display:block; animation: pop .35s ease; }
    .final h4{ margin:0 0 8px; font-size:16px; }
    .final .big{
      font-size:18px;
      letter-spacing:.6px;
      margin:0 0 8px;
      text-shadow: 0 0 18px rgba(255,78,136,.20);
    }
    .final .sum{
      margin:0;
      color: rgba(255,255,255,.90);
      line-height:1.55;
      font-size:14px;
    }

    /* è¢å¹•å°å½©è›‹ï¼šæ–æ™ƒéœ‡æ’¼ */
    .shake{
      animation: shake .28s ease-in-out;
    }
    @keyframes shake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(calc(-6px * var(--shake))); }
      40%{ transform: translateX(calc(6px * var(--shake))); }
      60%{ transform: translateX(calc(-4px * var(--shake))); }
      80%{ transform: translateX(calc(4px * var(--shake))); }
      100%{ transform: translateX(0); }
    }

    /* Confetti canvas */
    canvas#confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:80;
    }

    /* å°å°æç¤ºï¼ˆæ•™å­¸ç”¨ï¼‰ */
    .footer-note{
      margin-top:12px;
      font-size:12px;
      color: rgba(255,255,255,.75);
      line-height:1.45;
    }
    .kbd{
      display:inline-block;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      font-size:11px;
      color: rgba(255,255,255,.9);
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <div class="dots"></div>
  <canvas id="confetti"></canvas>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>æˆ°å¾Œå°ç£ç¶“æ¿Ÿç™¼å±•ï¼šäººç”Ÿé¸æ“‡å¤§å†’éšª</h1>
          <small>å…­é—œå¡ï½œæ¯é—œ 1 å¥æƒ…å¢ƒ + 3 å€‹é¸æ“‡ + ä¸åŒäººç”Ÿçµå±€</small>
        </div>
      </div>
      <div class="pill">
        <div class="tag">ğŸ­ èª‡å¼µæˆ²åŠ‡ UI</div>
        <div class="tag">ğŸ§  è§’è‰²è¦–è§’æ€è€ƒ</div>
        <div class="tag">ğŸ§¾ äººç”Ÿå±¥æ­·è¡¨</div>
      </div>
    </div>
  </header>

  <main>
    <!-- å·¦ï¼šé—œå¡ä¸»ç•«é¢ -->
    <section class="card" id="mainCard">
      <div class="hero">
        <div class="title">
          <h2 id="stageTitle">é–‹å ´ï¼šæŒ‰ä¸‹é–‹å§‹ï¼Œå‘½é‹å°±é–‹æ¼”</h2>
          <p id="stageSub">ä½ ä¸æ˜¯åœ¨é¸ç­”æ¡ˆï¼Œä½ æ˜¯åœ¨æ›¿è§’è‰²é¸ã€Œäººç”Ÿã€ã€‚</p>
        </div>
        <div class="meter">
          <div class="bar" aria-label="é€²åº¦æ¢">
            <div id="progressFill"></div>
          </div>
          <div class="nums">
            <span id="progressText">é€²åº¦ï¼š0 / 6</span>
            <span id="scoreText">å‘½é‹åˆ†æ•¸ï¼š0</span>
          </div>
        </div>
      </div>

      <div class="stage">
        <div class="scene">
          <div class="avatar" id="avatar">
            <div class="emoji" id="avatarEmoji">ğŸ¬</div>
            <div class="stamp" id="avatarStamp">åºç« </div>
          </div>

          <div class="dialog">
            <h3>
              <span id="roleName">å°æ¼”æ—ç™½</span>
              <span class="badge" id="eraBadge">æº–å‚™ä¸Šç·š</span>
            </h3>
            <p id="sceneText">
              ä½ å°‡ç©¿è¶Š 1940s â†’ 1980sã€‚æ¯ä¸€é—œéƒ½æœ‰ä¸€å€‹è§’è‰²ã€ä¸€å€‹æ™‚ä»£ã€ä¸€å€‹é—œéµæŠ‰æ“‡ã€‚<br/>
              <b>è¦å‰‡ï¼š</b>é»é¸ A/B/Cï¼Œçœ‹çµå±€ï¼›æƒ³é‡é¸å¯ä»¥ã€Œæ™‚å…‰å€’å¸¶ã€ï¼›å…­é—œè·‘å®Œæœƒå¾—åˆ°ä½ çš„ã€Œäººç”Ÿç¸½çµå±€ã€ã€‚
            </p>
          </div>
        </div>

        <div class="choices" id="choices">
          <!-- JS å‹•æ…‹æ’å…¥ -->
        </div>

        <div class="result" id="resultBox" aria-live="polite">
          <div class="headline">
            <h4 id="resultTitle">å‘½é‹æ’­å ±</h4>
            <div class="tone" id="toneChip">â€”</div>
          </div>
          <p id="resultText"></p>
          <div class="hint" id="knowledgeHint"></div>
          <div class="actions">
            <button class="mini" id="redoBtn">âª æ™‚å…‰å€’å¸¶ï¼ˆé‡é¸æœ¬é—œï¼‰</button>
            <button class="mini primary" id="nextBtn">â¡ï¸ ç¹¼çºŒä¸‹ä¸€é—œ</button>
            <button class="mini danger" id="resetBtn">ğŸ’¥ å…¨éƒ¨é‡ä¾†ï¼ˆæ¸…ç©ºäººç”Ÿï¼‰</button>
          </div>
        </div>

        <div class="final" id="finalBox" aria-live="polite">
          <h4>ğŸ† çµ‚ç« ï¼šä½ çš„ã€Œäººç”Ÿç¸½çµå±€ã€å‡ºçˆï¼</h4>
          <p class="big" id="finalTitle"></p>
          <p class="sum" id="finalSummary"></p>
          <div class="actions" style="margin-top:12px;">
            <button class="mini primary" id="replayBtn">ğŸ” å†ç©ä¸€æ¬¡ï¼ˆæ›å€‹äººç”Ÿï¼‰</button>
          </div>
        </div>

        <div class="footer-note">
          æ•™å­¸å°æç¤ºï¼šä½ ä¹Ÿå¯ä»¥è®“å­¸ç”Ÿå£é ­èªªæ˜ã€Œç‚ºä»€éº¼é¸é€™å€‹ã€å†æŒ‰éˆ•ï¼Œè®“æ­·å²è®Šæˆã€Œæœ‰ç†ç”±çš„æ±ºç­–ã€ã€‚<br/>
          å°å½©è›‹ï¼šæŒ‰éˆ•æœƒæœ‰éŸ³æ•ˆï¼›é‡å¤§å‘½é‹æœƒç‘å½©å¸¶ï¼ˆå¦‚æœç€è¦½å™¨å…è¨±ï¼‰ã€‚<span class="kbd">ï¼ˆå¯é›¢ç·šä½¿ç”¨ï¼‰</span>
        </div>
      </div>
    </section>

    <!-- å³ï¼šäººç”Ÿå±¥æ­· -->
    <aside class="card side">
      <div class="panel">
        <h3>ğŸ§¾ äººç”Ÿå±¥æ­·è¡¨ï¼ˆä½ ä¸€è·¯æ€éº¼é¸ï¼‰</h3>
        <div class="timeline" id="timeline"></div>
      </div>
    </aside>
  </main>

  <script>
    // ====== è³‡æ–™ï¼šå…­é—œå¡ï¼ˆä¾ä½ æä¾›çš„å°æ‡‰çµæœï¼‰=====
    // outcomeScoreï¼šâ‘¢=3ï¼ˆæˆé•·/ç´…åˆ©ï¼‰ã€â‘¡=2ï¼ˆç©©å®š/æŠ˜è¡·ï¼‰ã€â‘ =1ï¼ˆä»£åƒ¹/éŒ¯é/å£“åŠ›ï¼‰
    const stages = [
      {
        id:1,
        era:"æ°‘åœ‹40å¹´ä»£ï½œè€•è€…æœ‰å…¶ç”°",
        badge:"åœŸåœ°å¤§æ”¹é€ ",
        role:"å˜‰å—å¹³åŸçš„è¾²æ°‘é˜¿æˆ",
        emoji:"ğŸŒ¾",
        stamp:"è¾²æ°‘",
        scene:"ä½ å®¶ä¸–ä»£è€•ä½œä½†éƒ½ç§Ÿåœ°ä¸»åœŸåœ°ï¼Œæ¯å¹´è¦ç¹³ä¸‰åˆ°äº”æˆç§Ÿé‡‘ã€‚æ”¿åºœæ¨å‹•ã€Œè€•è€…æœ‰å…¶ç”°ã€ï¼Œä½ å¯ä»¥ä½åˆ©è²¸æ¬¾è²·åœ°ã€‚ä½ è¦æ€éº¼é¸ï¼Ÿ",
        choices:[
          { key:"A", label:"è²¸æ¬¾è³¼åœ°ï¼Œæˆç‚ºè‡ªè€•è¾²", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ å’¬ç‰™è²¸æ¬¾è²·ä¸‹åœŸåœ°ï¼å¾æ­¤ä¸ç”¨å†ç¹³é«˜é¡åœ°ç§Ÿï¼ŒåŠªåŠ›ç›´æ¥è®Šæˆè‡ªå·±çš„æ”¶ç©«ã€‚ç”Ÿæ´»æ›´ç©©å®šï¼Œå®¶äººä¹Ÿæ›´æœ‰ç›¼æœ›ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šåœŸåœ°æ”¹é©è®“ã€Œè€•è€…æœ‰å…¶ç”°ã€ï¼Œè¾²æ°‘å¾ä½ƒè¾²è½‰ç‚ºè‡ªè€•è¾²ï¼Œæ”¶å…¥èˆ‡ç”Ÿæ´»ç©©å®šåº¦æå‡ã€‚"
            }
          },
          { key:"B", label:"ä¸é¡˜è² å‚µï¼Œç¹¼çºŒç§Ÿåœ°è€•ä½œ", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ é¸æ“‡ä¸å†’é¢¨éšªï¼šç¹¼çºŒç§Ÿåœ°ã€‚é›–ç„¶æ¯”è¼ƒå®‰å¿ƒï¼Œä½†æ”¶å…¥ä»çœ‹å¤©åƒé£¯ã€ç§Ÿé‡‘å›ºå®šï¼Œç”Ÿæ´»æ”¹å–„æœ‰é™ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šç¶­æŒä½ƒè¾²èº«åˆ†ï¼åœ°ç§Ÿå£“åŠ›ä»åœ¨ï¼Œå®¹æ˜“å—å¤©å€™èˆ‡å¸‚å ´æ³¢å‹•å½±éŸ¿ã€‚"
            }
          },
          { key:"C", label:"è½‰å»ç³–å» åšå·¥ï¼Œé ˜ç©©å®šè–ªæ°´", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"ä½ é€²ç³–å» ç•¶å·¥äººï¼Œå·¥ä½œæ™‚é–“å›ºå®šã€é ˜è–ªæ°´ï¼Œä½†å¾æ­¤å’ŒåœŸåœ°æ¼¸æ¼¸ç–é ã€‚ç©©å®šæ˜¯ç©©å®šäº†ï¼Œå»ä¹Ÿå°‘äº†ã€Œæ“æœ‰åœŸåœ°ã€çš„å¯èƒ½ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šæˆ°å¾Œé€æ­¥å¾è¾²æ¥­èµ°å‘å·¥æ¥­ï¼Œå·¥å» æä¾›å·¥è³‡èˆ‡è¦å¾‹ï¼Œä½†ä¹Ÿå¸¶ä¾†ç”Ÿæ´»å‹æ…‹è½‰è®Šã€‚"
            }
          }
        ]
      },
      {
        id:2,
        era:"1950å¹´ä»£ï½œç¾æ´èˆ‡æ°´åº«èˆˆå»º",
        badge:"åƒä»€éº¼ï¼‹åšä»€éº¼",
        role:"å¤§ç¨»åŸ•çš„ä¸»å©¦é˜¿æ¢…",
        emoji:"ğŸ",
        stamp:"ä¸»å©¦",
        scene:"å°ç£å‰›èµ°å‡ºæˆ°å¾Œå›°é›£ï¼Œç¾åœ‹æä¾›éºµç²‰ã€å¥¶ç²‰ç­‰ç‰©è³‡ï¼›æ”¿åºœä¹Ÿé–‹å§‹èˆˆå»ºçŸ³é–€æ°´åº«ã€‚ä½ æƒ³æ€éº¼æå‡å®¶äººç”Ÿæ´»ï¼Ÿ",
        choices:[
          { key:"A", label:"å …æŒå‚³çµ±ç¨»ç±³ï¼Œä¸æ”¹é£²é£Ÿ", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ é¸æ“‡ç†Ÿæ‚‰çš„ç¨»ç±³ã€‚ä½†ç•¶æ™‚ç¨»ç±³æ˜¯å¤–éŠ·è³ºå¤–åŒ¯çš„é‡è¦ç‰©è³‡ï¼Œåƒ¹æ ¼è¼ƒé«˜ï¼Œå®¶ä¸­é–‹éŠ·è®Šå¾—æ¯”è¼ƒåƒç·Šã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šç¾æ´ç‰©è³‡è£œå……ç³§é£Ÿï¼›ç¨»ç±³å¤–éŠ·æ›å¤–åŒ¯ï¼Œåƒ¹æ ¼ç›¸å°é«˜ï¼Œå®¶åº­è² æ“”å¯èƒ½æ›´å¤§ã€‚"
            }
          },
          { key:"B", label:"æ”¹ç”¨ç¾æ´éºµç²‰/å¥¶ç²‰ï¼Œæ”¹å–„ç‡Ÿé¤Š", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ å‹‡æ•¢èª¿æ•´é£²é£Ÿï¼éºµç²‰ã€å¥¶ç²‰è£œè¶³è›‹ç™½è³ªèˆ‡æ¾±ç²‰ï¼Œå­©å­é«”åŠ›ã€å¥åº·æ˜é¡¯è®Šå¥½ï¼Œå®¶äººç²¾ç¥ä¹Ÿæ›´æœ‰åŠ›æ°£ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šç¾æ´å”åŠ©è£œå……ç‰©è³‡ã€æ”¹å–„ç‡Ÿé¤Šï¼Œæ”¯æ’æˆ°å¾Œç¤¾æœƒç©©å®šèˆ‡å»ºè¨­æ¨é€²ã€‚"
            }
          },
          { key:"C", label:"è®“å­å¥³å»çŸ³é–€æ°´åº«å·¥åœ°å¢åŠ æ”¶å…¥", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"å·¥åœ°è–ªæ°´ä¸éŒ¯ï¼Œä½†çœŸçš„è‹¦ã€‚å®¶äººé•·æ™‚é–“ä¸åœ¨å®¶ï¼Œå·¥åœ°ç”Ÿæ´»è¾›è‹¦åˆå±éšªï¼›è³ºåˆ°éŒ¢ï¼Œä¹Ÿä»˜å‡ºå¾ˆå¤§çš„ä»£åƒ¹ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šå¤§å‹å…¬å…±å»ºè¨­å¸¶ä¾†å°±æ¥­èˆ‡æ”¶å…¥ï¼Œä½†å‹å‹•å¼·åº¦é«˜ã€å®¶åº­ç›¸è™•æ™‚é–“æ¸›å°‘ã€‚"
            }
          }
        ]
      },
      {
        id:3,
        era:"1960å¹´ä»£ï½œè¼•å·¥æ¥­èˆˆèµ·",
        badge:"å®¢å»³å³å·¥å» ",
        role:"å°ä¸­æ¸…æ°´çš„å°‘å¥³ç§€ç´",
        emoji:"ğŸ§µ",
        stamp:"å°‘å¥³",
        scene:"ç´¡ç¹”ã€å¡‘è† ã€é£Ÿå“åŠ å·¥å¿«é€Ÿæˆé•·ï¼Œå¾ˆå¤šå¥³ç”Ÿç¬¬ä¸€æ¬¡å‡ºé–€åšå·¥ã€‚ä½ è¦ç•™åœ¨å®¶å‹™è¾²ï¼Ÿå»å·¥å» ï¼Ÿé‚„æ˜¯å»å­¸æŠ€è¡“ï¼Ÿ",
        choices:[
          { key:"A", label:"å»ç´¡ç¹”å·¥å» ä¸Šç­ï¼Œè³ºç¬¬ä¸€ä»½è–ªæ°´", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ èµ°é€²æ©Ÿå°è½Ÿé³´çš„å·¥å» ï¼Œæ‹¿åˆ°äººç”Ÿç¬¬ä¸€ä»½è–ªæ°´ã€‚å®¶ä¸­ç¶“æ¿Ÿæ”¹å–„ï¼Œä½†ä½ ä¹Ÿå¾—é¢å°é•·æ™‚é–“ã€å–®èª¿é«˜å£“çš„ä½œæ¥­ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šè¼•å·¥æ¥­å¸¶ä¾†å¤§é‡å°±æ¥­èˆ‡å‡ºå£æ©Ÿæœƒï¼Œä½†å‹å‹•å¯†é›†ã€å·¥æ™‚é•·ï¼Œæ˜¯å·¥æ¥­åŒ–æ—©æœŸå¸¸è¦‹æ¨£è²Œã€‚"
            }
          },
          { key:"B", label:"ç•™åœ¨å®¶å‹™è¾²èˆ‡ç…§é¡§å®¶äºº", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ é¸æ“‡å®‰ç©©ï¼šç•™åœ¨å®¶è£¡ã€‚ç”Ÿæ´»æ­¥èª¿ç†Ÿæ‚‰ï¼Œä½†ä¹Ÿå®¹æ˜“éŒ¯éå·¥æ¥­åŒ–å¸¶ä¾†çš„æ–°æ©Ÿæœƒï¼Œå’Œå¤–ç•Œç™¼å±•è·é›¢è®Šé ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šå·¥æ¥­åŒ–è½‰å‹æ™‚ï¼Œç•™åœ¨å‚³çµ±è¾²æ¥­è¼ƒç©©ï¼Œä½†æ”¶å…¥æˆé•·èˆ‡æ©Ÿæœƒå¯èƒ½å—é™ã€‚"
            }
          },
          { key:"C", label:"å»æŠ€è¡“åŸ¹è¨“ç­ï¼Œå…ˆå­¸ä¸€æŠ€ä¹‹é•·", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"ä½ é¸æ“‡å…ˆå­¸æŠ€è¡“ï¼Œä¸æ€¥è‘—å»æ‹šç”¢é‡ã€‚çŸ­æœŸå¯èƒ½è³ºå¾—æ¯”è¼ƒæ…¢ï¼Œä½†é•·é æ›´æœ‰å½ˆæ€§ï¼Œæœªä¾†æ›´æœ‰æ©Ÿæœƒæ‹¿åˆ°æ›´å¥½çš„è·ä½ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šæŠ•è³‡æŠ€èƒ½ï¼æå‡è·æ¶¯å½ˆæ€§ï¼ˆä¸æ˜¯åªè³£å‹åŠ›ï¼‰ã€‚çŸ­æœŸæ…¢ï¼Œé•·æœŸå¯èƒ½æ›´å¼·ã€‚"
            }
          }
        ]
      },
      {
        id:4,
        era:"1960s-1970sï½œåŠ å·¥å‡ºå£å€",
        badge:"å·¥å» å¤§çˆ†ç™¼",
        role:"é«˜é›„é³³å±±çš„é’å¹´é˜¿æ³°",
        emoji:"ğŸ­",
        stamp:"é’å¹´",
        scene:"åŠ å·¥å‡ºå£å€æˆç«‹ã€å¤–åœ‹å…¬å¸é€²é§ï¼Œè½èªªè–ªæ°´ç¿»å€ï¼›ä¹Ÿæœ‰äººå»å¤–åŒ…å°å·¥å» æˆ–ç•™åœ¨è¾²æ‘ã€‚ä½ è¦æ€éº¼èµ°ï¼Ÿ",
        choices:[
          { key:"A", label:"å»å¤–åŒ…å°å·¥å» ç•¶è‡¨æ™‚å·¥ï¼ˆæ¥å–®åšï¼‰", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ é€²äº†å¤–åŒ…å°å·¥å» ï¼Œå·¥ä½œå½ˆæ€§å¤§ï¼Œä½†æ”¶å…¥è·Ÿè¨‚å–®è·‘ï¼šæ—ºå­£å¿™åˆ°é£›èµ·ã€æ·¡å­£è·åŒ…å°±ç¸®æ°´ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šå¤–åŒ…/å®¶åº­å¼å·¥å» åœ¨å‡ºå£ç”¢æ¥­éˆä¸­å¾ˆå¸¸è¦‹ï¼›å½ˆæ€§é«˜ä½†ä¸ç©©å®šã€‚"
            }
          },
          { key:"B", label:"ç•™åœ¨å®¶é„‰å‹™è¾²ï¼ˆæ…¢æ…¢ä¾†ï¼‰", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"ä½ ç•™åœ¨è¾²æ‘ï¼Œæ­¥èª¿è¼ƒæ…¢ã€å£“åŠ›å°ï¼Œä½†ç›¸è¼ƒå·¥æ¥­è–ªè³‡é£›å¿«æˆé•·ï¼Œè¾²æ‘æ”¶å…¥æå‡ç©ºé–“å¾ˆæœ‰é™ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šå·¥æ¥­åŒ–æ™‚æœŸï¼Œè¾²æ¥­ç›¸å°æˆé•·æ…¢ï¼›åŸé„‰å·®è·å®¹æ˜“æ‹‰å¤§ã€‚"
            }
          },
          { key:"C", label:"é€²åŠ å·¥å‡ºå£å€ç•¶æ­£å¼å“¡å·¥ï¼ˆå¤§å» åˆ¶åº¦ï¼‰", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ é€²å¤§å·¥å» ï¼Œåˆ¶åº¦å®Œå–„ã€è–ªæ°´é«˜ï¼Œä½†ç®¡ç†åš´æ ¼ã€å·¥æ™‚é•·ï¼Œé‚„è¦é©æ‡‰é•·æ™‚é–“ç«™ç«‹èˆ‡é«˜å¼·åº¦ä½œæ¥­ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šå‡ºå£å€å¸¶å‹•å·¥æ¥­èˆ‡å¤–éŠ·ï¼Œæä¾›è¼ƒç©©å®šé«˜è–ªï¼Œä½†å‹å‹•å¼·åº¦ä¹Ÿæ›´å¤§ã€‚"
            }
          }
        ]
      },
      {
        id:5,
        era:"1970å¹´ä»£ï½œåå¤§å»ºè¨­ï¼šä¸­å±±é«˜",
        badge:"é€Ÿåº¦å°±æ˜¯éŒ¢",
        role:"å°å—çš„å¡è»Šå¸æ©Ÿé˜¿åœ‹",
        emoji:"ğŸšš",
        stamp:"å¸æ©Ÿ",
        scene:"ä¸­å±±é«˜é€Ÿå…¬è·¯é€šè»Šï¼Œå¾ˆå¤šå¸æ©Ÿæ”¹è·‘é«˜é€Ÿè·¯ç·šã€‚ä½ è¦è·Ÿä¸Šï¼Ÿç¶­æŒçœé“ï¼Ÿæˆ–åŠ å…¥å¤§å…¬å¸å›ºå®šæ’ç­ï¼Ÿ",
        choices:[
          { key:"A", label:"æ”¹è·‘é«˜é€Ÿå…¬è·¯é•·é€”é‹è¼¸ï¼ˆæ‹šæ•ˆç‡ï¼‰", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ è¡ä¸Šé«˜é€Ÿå…¬è·¯ï¼å—åŒ—å¾€è¿”æ™‚é–“å¤§ç¸®çŸ­ï¼Œæ•ˆç‡æå‡ã€æ¥æ›´å¤šå–®ï¼Œæ”¶å…¥ä¹Ÿè·Ÿè‘—å¾€ä¸Šè·³ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šäº¤é€šå»ºè¨­é™ä½é‹è¼¸æˆæœ¬ã€æé«˜æ•ˆç‡ï¼Œå¸¶å‹•ç‰©æµèˆ‡ç¶“æ¿Ÿæ´»å‹•ã€‚"
            }
          },
          { key:"B", label:"ç¹¼çºŒèµ°çœé“ï¼ˆç…§èˆŠï¼‰", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"ä½ ç…§èµ°çœé“ï¼šç´…ç¶ ç‡ˆå¤šã€é™é€Ÿä½ï¼Œè€—æ™‚è²»ç¥ã€‚åœ¨è¬›æ±‚æ•ˆç‡çš„å¸‚å ´ä¸­ï¼Œç«¶çˆ­åŠ›æ…¢æ…¢è¢«æ‹‰é–‹ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šåŸºç¤å»ºè¨­æ”¹è®Šå¸‚å ´ç«¶çˆ­è¦å‰‡ï¼›ä¸è·Ÿä¸Šå¯èƒ½è¢«æ•ˆç‡æ·˜æ±°ã€‚"
            }
          },
          { key:"C", label:"åŠ å…¥å¤§å‹å…¬å¸å›ºå®šæ’ç­ï¼ˆç©©å®šä¿éšœï¼‰", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ åŠ å…¥å¤§å…¬å¸ï¼Œæ”¶å…¥ç©©å®šã€æœ‰ä¿éšœï¼Œä½†ä¹Ÿå¾—é…åˆå…¬å¸èª¿åº¦èˆ‡æ’ç­ï¼šè‡ªç”±åº¦ä¸‹é™ï¼Œæ›ä¾†å®‰å…¨æ„Ÿã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šåˆ¶åº¦åŒ–ä¼æ¥­æä¾›ç©©å®šï¼Œä½†æœƒå£“ç¸®å€‹äººå½ˆæ€§ã€‚"
            }
          }
        ]
      },
      {
        id:6,
        era:"1980å¹´ä»£ï½œæ–°ç«¹ç§‘å­¸åœ’å€",
        badge:"é«˜ç§‘æŠ€ç™»å ´",
        role:"æ–°ç«¹æ±å€çš„é˜¿æ…§",
        emoji:"ğŸ§ª",
        stamp:"å±…æ°‘",
        scene:"ç§‘å­¸åœ’å€æˆç«‹ï¼Œäººå£æ¹§å…¥ã€åŸå¸‚å¿«é€Ÿç™¼å±•ã€‚ä½ å®¶æ—åœ¨é™„è¿‘æœ‰åœŸåœ°ã€‚ä½ è¦é€²åœ’å€ï¼Ÿè³£åœ°æ¬èµ°ï¼Ÿé‚„æ˜¯åšæœå‹™æ¥­ï¼Ÿ",
        choices:[
          { key:"A", label:"æ‡‰å¾µåœ’å€æŠ€è¡“å“¡ï¼ˆé«˜ç§‘æŠ€ç´…åˆ©ï¼‰", tone:"good",
            outcome:{ code:"â‘¢", score:3,
              text:"ä½ é€²åœ’å€åƒåˆ°ç”¢æ¥­ç´…åˆ©ï¼Œè–ªæ°´æ›´é«˜ã€æŠ€èƒ½æå‡å¿«ã€‚ä½†æ–°ç«¹ç”Ÿæ´»æˆæœ¬èˆ‡æˆ¿åƒ¹ä¹Ÿé£›èµ·ä¾†ï¼Œå£“åŠ›è·Ÿè‘—å‡ç´šã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šé«˜ç§‘æŠ€ç”¢æ¥­å¸¶ä¾†é«˜è–ªèˆ‡äººå£é›†ä¸­ï¼Œä¹Ÿæ¨å‡æˆ¿åƒ¹èˆ‡ç”Ÿæ´»æˆæœ¬ã€‚"
            }
          },
          { key:"B", label:"å‡ºå”®åœŸåœ°æ¬åˆ°é„‰æ‘ï¼ˆæ‹¿ä¸€æ¡¶é‡‘ï¼‰", tone:"bad",
            outcome:{ code:"â‘ ", score:1,
              text:"ä½ è³£åœ°ç«‹åˆ»è‡´å¯Œï¼ä½†æœªä¾†æˆ¿åƒ¹æŒçºŒä¸Šæ¼²ï¼Œä½ çœ‹è‘—è‡ªå·±æ›¾æ“æœ‰çš„å¢å€¼å¯èƒ½é›¢ä½ è€Œå»ï¼›æ•…é„‰æ™¯è§€ä¹Ÿå¤§è®Šæ¨£ã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šåœŸåœ°è®Šç¾æ˜¯ä¸€æ¬¡æ€§æ”¶å…¥ï¼›ä½†ä¹Ÿå¯èƒ½å¤±å»é•·æœŸå¢å€¼èˆ‡åœ°æ–¹æƒ…æ„Ÿã€‚"
            }
          },
          { key:"C", label:"è½‰å¾€æœå‹™æ¥­ï¼ˆé¤é£²/ä½å®¿/é›¶å”®ï¼‰", tone:"mid",
            outcome:{ code:"â‘¡", score:2,
              text:"ä½ ä¸ç•¶å·¥ç¨‹å¸«ä¹Ÿèƒ½è³ºï¼šåœ’å€å¸¶ä¾†å¤§é‡äººæ½®èˆ‡æ¶ˆè²»ï¼Œåº—è£¡å®¢æºç©©ã€‚æ”¶å…¥æ™®é€šä½†ç©©å®šï¼Œé éœ€æ±‚æˆé•·æ…¢æ…¢æ“´å¼µã€‚",
              hint:"é—œéµæ¦‚å¿µï¼šç”¢æ¥­èšè½æœƒå¸¶å‹•å‘¨é‚Šæœå‹™æ¥­éœ€æ±‚ï¼Œå½¢æˆã€Œé–“æ¥å—ç›Šã€ã€‚"
            }
          }
        ]
      }
    ];

    // ====== ç‹€æ…‹ ======
    const state = {
      index: -1,        // -1 = åºç« 
      score: 0,
      picks: Array(stages.length).fill(null) // {stageId, choiceKey, outcomeCode, score, brief}
    };

    // ====== DOM ======
    const stageTitle = document.getElementById("stageTitle");
    const stageSub   = document.getElementById("stageSub");
    const progressFill = document.getElementById("progressFill");
    const progressText = document.getElementById("progressText");
    const scoreText = document.getElementById("scoreText");

    const avatarEmoji = document.getElementById("avatarEmoji");
    const avatarStamp = document.getElementById("avatarStamp");

    const roleName = document.getElementById("roleName");
    const eraBadge = document.getElementById("eraBadge");
    const sceneText = document.getElementById("sceneText");

    const choicesWrap = document.getElementById("choices");
    const resultBox = document.getElementById("resultBox");
    const resultTitle = document.getElementById("resultTitle");
    const toneChip = document.getElementById("toneChip");
    const resultText = document.getElementById("resultText");
    const knowledgeHint = document.getElementById("knowledgeHint");

    const redoBtn = document.getElementById("redoBtn");
    const nextBtn = document.getElementById("nextBtn");
    const resetBtn = document.getElementById("resetBtn");

    const finalBox = document.getElementById("finalBox");
    const finalTitle = document.getElementById("finalTitle");
    const finalSummary = document.getElementById("finalSummary");
    const replayBtn = document.getElementById("replayBtn");

    const timeline = document.getElementById("timeline");
    const mainCard = document.getElementById("mainCard");

    // ====== éŸ³æ•ˆï¼ˆä¸ä¾è³´å¤–éƒ¨æª”æ¡ˆï¼‰=====
    let audioCtx = null;
    function beep(type="click"){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);

        const now = audioCtx.currentTime;
        const freq = type==="good" ? 880 : type==="mid" ? 660 : type==="bad" ? 220 : 520;
        o.frequency.setValueAtTime(freq, now);
        o.type = "square";
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.12, now+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now+0.15);
        o.start(now);
        o.stop(now+0.16);
      }catch(e){}
    }

    function screenShake(intensity=1){
      mainCard.style.setProperty("--shake", intensity);
      mainCard.classList.remove("shake");
      void mainCard.offsetWidth; // reflow
      mainCard.classList.add("shake");
      setTimeout(()=>mainCard.classList.remove("shake"), 320);
    }

    // ====== Confettiï¼ˆç°¡æ˜“ï¼‰=====
    const confCanvas = document.getElementById("confetti");
    const ctx = confCanvas.getContext("2d");
    let confettiPieces = [];
    function resizeConfetti(){
      confCanvas.width = window.innerWidth * devicePixelRatio;
      confCanvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeConfetti);
    resizeConfetti();

    function throwConfetti(power=120){
      const w = window.innerWidth, h = window.innerHeight;
      const cx = w * 0.5, cy = h * 0.25;
      const n = Math.min(220, Math.max(60, power));
      for(let i=0;i<n;i++){
        confettiPieces.push({
          x: cx + (Math.random()*80-40),
          y: cy + (Math.random()*40-20),
          vx: (Math.random()*6-3) * (0.9 + Math.random()*0.6),
          vy: (Math.random()*-8-2) * (0.9 + Math.random()*0.6),
          r: 2 + Math.random()*4,
          rot: Math.random()*Math.PI,
          vr: (Math.random()*0.2-0.1),
          life: 120 + Math.random()*60
        });
      }
    }
    function tickConfetti(){
      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
      confettiPieces = confettiPieces.filter(p=>p.life>0);
      for(const p of confettiPieces){
        p.life--;
        p.vy += 0.22;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        const alpha = Math.min(1, p.life/40);
        ctx.globalAlpha = alpha;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }
      ctx.globalAlpha = 1;
      requestAnimationFrame(tickConfetti);
    }
    // ç”¨ä¸åŒé¡è‰²ç¹ªè£½ï¼šæ¯ä¸€å¹€éš¨æ©Ÿè®Šï¼ˆèª‡å¼µæ¼«ç•«æ„Ÿï¼‰
    const oldFillRect = ctx.fillRect.bind(ctx);
    ctx.fillRect = function(x,y,w,h){
      ctx.fillStyle = ["#00e5ff","#7c4dff","#ff4e88","#35ff8a","#ffd34e"][Math.floor(Math.random()*5)];
      oldFillRect(x,y,w,h);
    };
    tickConfetti();

    // ====== UIï¼šäººç”Ÿå±¥æ­·ï¼ˆå³å´ï¼‰=====
    function renderTimeline(){
      timeline.innerHTML = "";
      stages.forEach((s, i)=>{
        const picked = state.picks[i];
        const row = document.createElement("div");
        row.className = "row " + (picked ? "done" : "locked");

        const dot = document.createElement("div");
        dot.className = "dot";
        dot.textContent = picked ? "âœ…" : (i <= state.index ? "ğŸ•’" : "ğŸ”’");

        const meta = document.createElement("div");
        meta.className = "meta";

        const k = document.createElement("div");
        k.className = "k";
        const title = document.createElement("div");
        title.textContent = `ç¬¬${i+1}é—œï½œ${s.role.split("çš„").pop()}`;
        const tag = document.createElement("span");
        tag.textContent = picked ? `é¸${picked.choiceKey}ãƒ»${picked.outcomeCode}` : s.badge;

        k.appendChild(title);
        k.appendChild(tag);

        const v = document.createElement("div");
        v.className = "v";
        v.textContent = picked ? picked.brief : "å°šæœªå¯«ä¸‹å‘½é‹â€¦";

        meta.appendChild(k);
        meta.appendChild(v);

        row.appendChild(dot);
        row.appendChild(meta);

        timeline.appendChild(row);
      });
    }

    // ====== é€²åº¦ ======
    function renderProgress(){
      const done = state.picks.filter(Boolean).length;
      progressText.textContent = `é€²åº¦ï¼š${done} / 6`;
      scoreText.textContent = `å‘½é‹åˆ†æ•¸ï¼š${state.score}`;
      const pct = (done/6)*100;
      progressFill.style.width = pct.toFixed(0) + "%";
    }

    // ====== åºç«  / é—œå¡æ¸²æŸ“ ======
    function renderIntro(){
      state.index = -1;
      stageTitle.textContent = "åºç« ï¼šå‘½é‹å°æ¼”å–Šå¡ä¹‹å‰ï¼Œä½ éƒ½èƒ½é‡é¸";
      stageSub.textContent = "å…­å€‹è§’è‰²ï¼Œå…­æ¬¡æŠ‰æ“‡ï¼šçœ‹è¦‹æ”¿ç­–èˆ‡å»ºè¨­å¦‚ä½•æ”¹è®Šäººç”Ÿã€‚";
      avatarEmoji.textContent = "ğŸ¬";
      avatarStamp.textContent = "åºç« ";
      roleName.textContent = "å°æ¼”æ—ç™½";
      eraBadge.textContent = "æŒ‰ä¸‹é–‹å§‹";
      sceneText.innerHTML = `
        ä½ å°‡ä¾åºç¶“æ­·ï¼šåœŸåœ°æ”¹é© â†’ ç¾æ´/æ°´åº« â†’ è¼•å·¥æ¥­ â†’ åŠ å·¥å‡ºå£å€ â†’ åå¤§å»ºè¨­ â†’ ç§‘å­¸åœ’å€ã€‚<br/>
        <b>ç©æ³•ï¼š</b>æ¯é—œé¸ A/B/Cï¼Œç«‹åˆ»çœ‹åˆ°ä¸åŒäººç”Ÿçµæœï¼›å®Œæˆå…­é—œæœƒç”Ÿæˆä½ çš„ã€Œäººç”Ÿç¸½çµå±€ã€ã€‚
      `;
      resultBox.classList.remove("show");
      finalBox.classList.remove("show");

      choicesWrap.innerHTML = "";
      const startBtn = document.createElement("button");
      startBtn.className = "btn good";
      startBtn.innerHTML = `
        <div class="k"><strong>ğŸš€ é–‹å§‹æ¼”å‡ºï¼šç¬¬ä¸€é—œç™»å ´</strong><span class="chip">æŒ‰æˆ‘</span></div>
        <div class="t">æŠŠæ‰‹æ”¾åœ¨æ»‘é¼ ä¸Šï¼Œä½ å°±æ˜¯å‘½é‹ã€‚</div>
      `;
      startBtn.addEventListener("click", ()=>{
        beep("click");
        goStage(0);
      });
      choicesWrap.appendChild(startBtn);

      renderTimeline();
      renderProgress();
    }

    function goStage(i){
      state.index = i;
      const s = stages[i];

      stageTitle.textContent = `ç¬¬${s.id}é—œï¼š${s.era}`;
      stageSub.textContent = `æƒ…å¢ƒï¼š${s.badge}`;
      avatarEmoji.textContent = s.emoji;
      avatarStamp.textContent = s.stamp;
      roleName.textContent = s.role;
      eraBadge.textContent = s.era;
      sceneText.textContent = s.scene;

      finalBox.classList.remove("show");
      resultBox.classList.remove("show");

      // è‹¥æœ¬é—œå·²é¸éï¼šé¡¯ç¤ºå·²é¸çµæœ + å¯é‡é¸
      const already = state.picks[i];
      renderChoices(s, already);

      renderTimeline();
      renderProgress();
    }

    function renderChoices(stage, alreadyPick){
      choicesWrap.innerHTML = "";
      stage.choices.forEach(ch=>{
        const btn = document.createElement("button");
        btn.className = `btn ${ch.tone}`;
        btn.innerHTML = `
          <div class="k">
            <strong>${ch.key}. ${ch.label}</strong>
            <span class="chip">çµå±€ ${ch.outcome.code}ï½œ+${ch.outcome.score} åˆ†</span>
          </div>
          <div class="t">é»ä¸‹å»ï¼Œå‘½é‹å°±ä¸èƒ½è£æ²’äº‹ï¼ˆä½†ä½ å¯ä»¥é‡é¸ğŸ˜ˆï¼‰ã€‚</div>
        `;
        btn.addEventListener("click", ()=> choose(stage, ch));
        choicesWrap.appendChild(btn);
      });

      if(alreadyPick){
        // é¡¯ç¤ºå·²é¸çš„çµå±€
        const chosen = stage.choices.find(c=>c.key===alreadyPick.choiceKey);
        showOutcome(stage, chosen, true);
      }
    }

    function choose(stage, choice){
      // è‹¥æœ¬é—œä¹‹å‰é¸éï¼Œè¦å…ˆæ‰£å›èˆŠåˆ†æ•¸
      const idx = stage.id - 1;
      const prev = state.picks[idx];
      if(prev){
        state.score -= prev.score;
      }

      // è¨˜éŒ„æ–°é¸æ“‡
      state.picks[idx] = {
        stageId: stage.id,
        choiceKey: choice.key,
        outcomeCode: choice.outcome.code,
        score: choice.outcome.score,
        brief: `${choice.key} â†’ çµå±€${choice.outcome.code}ï¼š${choice.outcome.text}`
      };
      state.score += choice.outcome.score;

      // æˆ²åŠ‡æ•ˆæœ
      beep(choice.tone);
      if(choice.outcome.code === "â‘¢"){ throwConfetti(160); screenShake(0.6); }
      if(choice.outcome.code === "â‘¡"){ screenShake(0.35); }
      if(choice.outcome.code === "â‘ "){ screenShake(1.0); }

      showOutcome(stage, choice, false);
      renderTimeline();
      renderProgress();
    }

    function showOutcome(stage, choice, isReview){
      resultBox.classList.add("show");
      resultTitle.textContent = isReview ? "ä½ ä¹‹å‰é¸éçš„å‘½é‹ï¼ˆå¯é‡é¸ï¼‰" : "å‘½é‹æ’­å ±ï¼šä½ æŒ‰ä¸‹å»äº†ï¼";
      toneChip.className = "tone " + choice.tone;
      toneChip.textContent =
        choice.outcome.code==="â‘¢" ? "ğŸ‰ ç´…åˆ©çµå±€" :
        choice.outcome.code==="â‘¡" ? "ğŸ˜ ç©©å®šçµå±€" : "ğŸ’¥ ä»£åƒ¹çµå±€";

      resultText.textContent = choice.outcome.text;
      knowledgeHint.textContent = "ğŸ“Œ å°çŸ¥è­˜ï¼š" + choice.outcome.hint;

      // åªæœ‰æœ¬é—œå·²åšé¸æ“‡æ‰å…è¨±ä¸‹ä¸€é—œ
      nextBtn.disabled = false;
      nextBtn.style.opacity = 1;

      // å¦‚æœåˆ°äº†æœ€å¾Œä¸€é—œï¼Œnext è®Šæˆã€Œçœ‹ç¸½çµå±€ã€
      if(stage.id === 6){
        nextBtn.textContent = "ğŸ ç”Ÿæˆçµ‚ç« ï¼ˆäººç”Ÿç¸½çµå±€ï¼‰";
      }else{
        nextBtn.textContent = "â¡ï¸ ç¹¼çºŒä¸‹ä¸€é—œ";
      }
    }

    // ====== çµ‚ç« ï¼šä¾ç¸½åˆ†çµ¦ä¸€å€‹èª‡å¼µçµå±€ ======
    function buildFinal(){
      const total = state.score; // 6~18
      let title, summary;

      if(total >= 16){
        title = "ã€Œä¹˜é¢¨ç ´æµªå‹ã€ï¼šä½ ç¸½èƒ½æŠ“ä½æ”¿ç­–ç´…åˆ©ï¼Œé‚„æ•¢æ‰›ä»£åƒ¹ï¼";
        summary = "ä½ å¾ˆæœƒåœ¨é—œéµæ™‚åˆ»åšå‡ºã€Œå¸¶ä¾†æˆé•·ã€çš„é¸æ“‡ï¼šåœŸåœ°æ”¹é©ã€ç‡Ÿé¤Šæ”¹å–„ã€æ•ˆç‡æå‡ã€é«˜ç§‘æŠ€ç´…åˆ©â€¦ä½ éƒ½ä¸æ”¾éã€‚ä½ çš„è·¯å¸¸å¸¸æ¯”è¼ƒè¾›è‹¦ã€ç¯€å¥æ›´å¿«ï¼Œä½†ä½ ç”¨æ±ºç­–æ›åˆ°äº†æ›´å¤§çš„èˆå°ã€‚";
      }else if(total >= 13){
        title = "ã€Œç©©ä¸­æ±‚é€²å‹ã€ï¼šä½ ä¸äº‚è¡ï¼Œä½†æ¯ä¸€æ­¥éƒ½åœ¨è®Šå¼·ã€‚";
        summary = "ä½ åå‘æŒ‘é¢¨éšªå¯æ§çš„è·¯ï¼šç©©å®šæ”¶å…¥ã€åˆ¶åº¦ä¿éšœã€æˆ–å…ˆç´¯ç©èƒ½åŠ›ã€‚ä½ ä¸æ˜¯æœ€æˆ²åŠ‡çš„é‚£ç¨®äººï¼Œä½†ä½ æœ€åƒã€Œå¯ä»¥èµ°å¾ˆé ã€çš„äººã€‚";
      }else if(total >= 10){
        title = "ã€Œå®‰å…¨ç¬¬ä¸€å‹ã€ï¼šä½ å¾ˆæœƒé¿é›·ï¼Œä½†ä¹Ÿå®¹æ˜“éŒ¯éå¤§æµªã€‚";
        summary = "ä½ å¸¸é¸æ“‡ç†Ÿæ‚‰èˆ‡å®‰å…¨æ„Ÿï¼šç•™åœ¨åŸæœ¬çš„ç”Ÿæ´»ç¯€å¥ï¼Œæˆ–ç”¨ç©©å®šæ›è‡ªç”±ã€‚é€™æ¨£æ¯”è¼ƒä¸æœƒç¿»èˆ¹ï¼Œä½†ä¹Ÿå¯èƒ½åœ¨å¤§è®Šå‹•æ™‚æœŸï¼Œçœ‹åˆ°åˆ¥äººçš„æ”¶å…¥èˆ‡æ©Ÿæœƒè·‘å¾—æ›´å¿«ã€‚";
      }else{
        title = "ã€Œè¢«æ™‚ä»£å·¨æµªæ‹åˆ°æ²™ç˜å‹ã€ï¼šä½ ä¸æ˜¯ä¸åŠªåŠ›ï¼Œæ˜¯é¸æ“‡å¤ªåƒè™§ã€‚";
        summary = "ä½ çš„è·¯å……æ»¿ä»£åƒ¹ï¼šå¯èƒ½å¤ªæ—©æ”¾æ£„åœŸåœ°ã€å¤ªè¾›è‹¦çš„å·¥åœ°ã€æˆ–åœ¨æ•ˆç‡ç«¶è³½è£¡æ…¢æ…¢è½å¾Œã€‚é€™ä¸æ˜¯ç”¨ä¾†å˜²ç¬‘ä½ ï¼Œè€Œæ˜¯æé†’ï¼šæ”¿ç­–èˆ‡å»ºè¨­æœƒæ”¹è®Šè¦å‰‡ï¼Œæ‡‚è¦å‰‡çš„äººæ¯”è¼ƒä¸æœƒè¢«æµªæ‰“ç¿»ã€‚";
      }

      finalTitle.textContent = title + `ï¼ˆç¸½åˆ†ï¼š${total} / 18ï¼‰`;
      finalSummary.textContent = summary;

      finalBox.classList.add("show");
      resultBox.classList.remove("show");

      // å¤§ç‘èŠ±
      throwConfetti(220);
      beep("good");
      screenShake(0.7);
    }

    // ====== æŒ‰éˆ•äº‹ä»¶ ======
    redoBtn.addEventListener("click", ()=>{
      beep("click");
      const i = state.index;
      if(i<0) return;
      // åªæŠŠæœ¬é—œæ¸…ç©º
      const prev = state.picks[i];
      if(prev){
        state.score -= prev.score;
        state.picks[i] = null;
      }
      resultBox.classList.remove("show");
      nextBtn.disabled = true;
      nextBtn.style.opacity = .75;

      // é‡æ–°æ¸²æŸ“æœ¬é—œ
      goStage(i);
    });

    nextBtn.addEventListener("click", ()=>{
      beep("click");
      const i = state.index;
      if(i<0) return;

      // å¿…é ˆå…ˆé¸éæœ¬é—œ
      if(!state.picks[i]){
        screenShake(1.0);
        return;
      }

      if(i === stages.length - 1){
        buildFinal();
        return;
      }
      goStage(i+1);
    });

    resetBtn.addEventListener("click", ()=>{
      beep("bad");
      screenShake(1.2);
      state.index = -1;
      state.score = 0;
      state.picks = Array(stages.length).fill(null);
      renderIntro();
    });

    replayBtn.addEventListener("click", ()=>{
      beep("click");
      state.index = -1;
      state.score = 0;
      state.picks = Array(stages.length).fill(null);
      renderIntro();
    });

    // ====== åˆå§‹åŒ– ======
    renderIntro();
  </script>
</body>
</html>
